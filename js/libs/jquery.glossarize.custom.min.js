!function(e,t,i){function s(){var i=e(".glossarizer_replaced"),s=!1,r=!1;i.bind("mouseenter",function(){if(s=e(this),tip=s.attr("title"),r=e('<div id="tooltip"></div>'),!tip||""==tip)return!1;s.removeAttr("title"),r.css("opacity",0).html(tip).appendTo("body");var i=function(){e(t).width()<1.5*r.outerWidth()?r.css("max-width",e(t).width()/2):r.css("max-width",340);var i=s.offset().left+s.outerWidth()/2-r.outerWidth()/2,o=s.offset().top-r.outerHeight()-20;if(0>i?(i=s.offset().left+s.outerWidth()/2-20,r.addClass("left")):r.removeClass("left"),i+r.outerWidth()>e(t).width()?(i=s.offset().left-r.outerWidth()+s.outerWidth()/2+20,r.addClass("right")):r.removeClass("right"),0>o){var o=s.offset().top+s.outerHeight();r.addClass("top")}else r.removeClass("top");r.css({left:i,top:o}).animate({top:"+=10",opacity:1},50)};i(),e(t).resize(i);var o=function(){r.animate({top:"-=10",opacity:0},50,function(){e(this).remove()}),s.attr("title",tip)};s.bind("mouseleave",o),r.bind("click",o)})}return t.tooltip=s}(jQuery,window),function(e){function t(t,i){function r(e){o.glossary=e;for(var t=0;t<o.glossary.length;t++)for(var i=o.glossary[t].term.split(","),s=0;s<i.length;s++){var r=i[s].replace(/^\s+|\s+$/g,""),a=r.indexOf("!");-1==a||0!=a?o.terms.push(r):o.excludes.push(r.substr(1))}o.wrapTerms()}var o=this;if(o.el=t,o.$el=e(t),o.options=e.extend({},s,i),o.terms=[],o.excludes=[],o.regexOption=o.options.replaceOnce?"i":"ig","string"==typeof this.options.sourceURL)e.getJSON(this.options.sourceURL).then(function(e){r(e)});else{if("object"!=typeof this.options.sourceURL)throw new Error("sourceURL invalid");r(this.options.sourceURL)}}var i="glossarizer",s={sourceURL:"",replaceTag:"abbr",lookupTagName:"p, ul, a",callback:null,replaceOnce:!1,replaceClass:"glossarizer_replaced"};t.prototype={getDescription:function(e){for(var t=new RegExp("(^s*|[^!])"+e+"\\s*|\\,$","i"),i=0;i<this.glossary.length;i++)if(this.glossary[i].term.match(t))return this.glossary[i].description},wrapTerms:function(){for(var e=this.el.querySelectorAll(this.options.lookupTagName),t=0;t<e.length;t++)this.traverser(e[t]);this.options.callback&&this.options.callback.call(this.$el)},traverser:function(e){var t,i=this;if(1===e.nodeType){if(e=e.firstChild)do t=e.nextSibling,"ABBR"!=e.nodeName&&e.className!=this.options.replaceClass&&this.traverser(e);while(e=t)}else if(3===e.nodeType){var s=document.createElement("div"),r=e.data,o=new RegExp("\\b("+this.terms.join("|")+")\\b",i.regexOption),a=new RegExp("\\b("+this.excludes.join("|")+")\\b",i.regexOption),n=!!this.excludes.length;if(o.test(r)){var l=a.exec(r);r=r.replace(o,function(e,t,s,o){var a=new RegExp("\\b"+e+"\\b"),p=a.exec(r);if(p){if(l&&n){var c=s,h=l.index,f=l.index+l[0].length;return c>=h&&f>=c?e:'<abbr class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</abbr>"}return'<abbr class="'+i.options.replaceClass+'" title="'+i.getDescription(e)+'">'+e+"</abbr>"}})}for(s.innerHTML=r;s.firstChild;)e.parentNode.insertBefore(s.firstChild,e);e.parentNode.removeChild(e)}}};var r={destroy:function(){this.$el.removeData("plugin_"+i),this.$el.find("."+this.options.replaceClass).each(function(){var t=e(this),i=t.text();t.replaceWith(i)})}};t.prototype=e.extend({},t.prototype,r),e.fn[i]=function(s){return this.each(function(){var o=e(this),a=o.data("plugin_"+i);"string"==typeof s&&a&&r.hasOwnProperty(s)?a[s].apply(a):(a&&a.destroy.apply(a),e.data(this,"plugin_"+i,new t(this,s)))})}}(jQuery);